<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JSONdb ruby gem by fernandezvara</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>JSONdb Ruby gem</h1>
        <p>Tiny local database JSON lib</p>

        <p class="view"><a href="https://github.com/fernandezvara/jsondb">View the Project on GitHub <small>fernandezvara/jsondb</small></a></p>


        <ul>
          <li><a href="https://github.com/fernandezvara/jsondb/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/fernandezvara/jsondb/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/fernandezvara/jsondb">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a name="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages"><span class="octicon octicon-link"></span></a>JSONdb</h3>

<p>This lib helps to create a little database organized in different JSON files inside a folder. It allows to interact inside a process with the data you need.</p>

<h3><a name="designer-templates" class="anchor" href="#designer-templates"><span class="octicon octicon-link"></span></a>Why use this underpowered lib instead of a real database?</h3>

<p>Well, this lib comes from one motivation: <i><strong>Currently we have really big repositories with Chef configuration</strong></i> that are used for too many people at the same time with many applications/environments/versions (around ~500 combinations).</p>

<p>To avoid human errors updating the big 'versions.rb' file (~500 lines) we made a first version of this lib using sqlite3 and it worked really nice.</p>

<p>But just <i>three days later</i> problems araise again. Someone forgot to pull the repo before make a change of  a version using the versions cli helper. I'm still figuring how to fix a sqlite database file after an unresolved merge.</p>

<p>Breaking something in a text file it's easy to fix, so let's make again the versions database but don't edit the files directly.</p>

<p>I hope <b>this</b> can be useful for someone else.</p>

<p>To start using it:</p>
<pre><code>$ gem install jsondb
</code></pre>

<p>Or just add it to your Gemfile<p>

<pre><code>source 'https://rubygems.org'
gem 'jsondb'
</code></pre>

<h3>
<a name="designer-templates" class="anchor" href="#designer-templates"><span class="octicon octicon-link"></span></a>How to use</h3>

<pre><code>require 'jsondb'

# remember that folder must exists or it will raise an error 
# (it's supposed that you want to use old data if exists)
# true if you want to allow writes

db = Db.new('/tmp/dbtest', true)     
</code></pre>

<h4>Tables</h4>
<pre><code># create a table
db.table_add("table_a")       # Allowed characters

# remove a table
db.table_remove("table_a")  

# create/use a table  
db.table("table_a")
</code></pre>

<h4>Fields</h4>
<pre><code># by default all tables have an id, created_at and updated_at 
# fields for every record in the table

db.table("table_a").fields.keys 
=>  ["id", "created_at", "updated_at"]

field = db.table("table_a").field("field_a")
field.nullable = true   # defaults to true
field.type = "String"   # defaults to "String". Allowed values: 
    # "Integer", "Float", "String", "Time", "Bool"
field.default = ""      # defaults to nil

db.table("table_a").fields.keys 
=>  ["id", "created_at", "updated_at", "field_a"]
</code></pre>

<h4>Records</h4>
<pre><code>record = db.table("table_a").new_record
record.field_a = "Sample data"

db.table("table_a").insert(record) # inserting a record

record.id 
=>  1

db.table("table_a").insert(record) 
    # fails, that record already exists!

record.field_a = "Another data"
db.table("table_a").update(record)

# Another record

record2 = db.table("table_a")
record2.field_a = 333 
    # Fails on validation 333 is a Numeric Type not String

db.table("table_a").insert(record)

db.table("table_a").records.count
=> 2
</code></pre>

<h4>Persistence</h4>
<pre><code>db.persist 
# It saves database structure and all the tables 
# that have changed in the session
</code></pre>

<h4>Queries</h4>
<pre><code>query = db.table("table_a").select 
  # returns an object ResultSet

result = query.result 
  # this is a select * from table_a;

result = query.equal("field_a", "Sample Data").result
  # select * from table_a where field_a="Sample Data";

result.count
==> 1

# you can use:
#  equal(field, value)
#  min(field, value)
#  max(field, value)
#  like(field, value)

# Queries are chainable
result = query.min("id", 1).max("id", 3).result

# do something with the data....
result.each do |id, record|
  puts record.field_a
end
</code></pre>

<h3>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>@fernandezvara</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/fernandezvara">fernandezvara</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>